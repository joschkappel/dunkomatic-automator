#####################################################################
# Update and configure base ubuntu server for laradock
#####################################################################

- name: Get OS release
  shell: lsb_release -c
  register: lsb_release


- set_fact: 
   codename: "{{ lsb_release.stdout | split(':') }}"
- set_fact:
    codename: "{{codename[1] | trim}}"
- ansible.builtin.debug:
    var: codename

- name: change acl
  ansible.builtin.file:
    path:  /usr/share/keyrings/docker-archive-keyring.gpg
    mode: a+r 
  ignore_errors: true

- name: Update apt cache
  raw: apt-get -y update

- name: If needed, install Python
  raw: apt-get -y install python3 python3-pip 

- name: Set Hostname
  hostname:
    name: "{{hostname}}"

- name: Gather Facts
  setup:

- name: Add hostname to hosts file
  lineinfile:
    dest: /etc/hosts
    line: "{{ advertise_address|default(hostvars[inventory_hostname]['ansible_default_ipv4']['address']) }} {{hostname}}"
    state: present
